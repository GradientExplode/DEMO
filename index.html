<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Imaging Toolbox - via Meshing and dMRI Simulating</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
</head>
<body>
    <section class="hero-section">
        <video class="hero-video" preload="auto" autoplay muted loop playsinline>
            <source src="video/background.mp4" type="video/mp4">
        </video>
        <div class="hero-title">
            <h1>Brain Imaging Toolbox</h1>
            <p>via Meshing and dMRI Simulating</p>
        </div>
    </section>
    <section class="mesh-section">
        <div class="mesh-inner">
            <div class="mesh-content glass">
                <h2>Brain Mesh Construction</h2>
                <div class="axon-mesh-branching">
                    <div class="grid-container">
                        <!-- First row -->
                        <div class="grid-row">
                            <div class="axon-block axon-base" id="axon-base-block">
                                <div class="axon-label">Axon (Base)</div>
                                <div class="mesh-viewer" id="axon-viewer"></div>
                            </div>
                            <div class="axon-block axon-box" id="axon-box-block">
                                <div class="axon-label">Axon Box</div>
                                <div class="mesh-viewer" id="axonbox-viewer"></div>
                            </div>
                            <div class="axon-block axon-crossing" id="axon-crossing-block">
                                <div class="axon-label">Axon Crossing</div>
                                <div class="mesh-viewer" id="axoncrossing-viewer"></div>
                            </div>
                        </div>
                        <!-- Second row -->
                        <div class="grid-row">
                            <div class="axon-block soma-base" id="soma-base-block">
                                <div class="axon-label">Soma (Base)</div>
                                <div class="mesh-viewer" id="soma-viewer"></div>
                            </div>
                            <div class="axon-block soma-process" id="soma-process-block">
                                <div class="axon-label">Soma Process</div>
                                <div class="mesh-viewer" id="somaprocess-viewer"></div>
                            </div>
                            <div class="axon-block soma-branching" id="soma-branching-block">
                                <div class="axon-label">Soma Branching</div>
                                <div class="mesh-viewer" id="somabranching-viewer"></div>
                            </div>
                        </div>
                    </div>
                    <svg class="axon-branch-svg" id="axon-branch-svg" width="100%" height="100%" style="position:absolute;top:0;left:0;pointer-events:none;z-index:1;"></svg>
                </div>
                <div class="mesh-explanation">
                    <div class="mesh-info">
                        <div class="mesh-type">
                            <h3>Axon Mesh Construction</h3>
                            <ul>
                                <li><strong>Axon Box</strong>: ABCD</li>
                                <li><strong>Axon Crossing</strong>: ABCD</li>
                            </ul>
                        </div>
                        <div class="mesh-type">
                            <h3>Soma Mesh Construction</h3>
                            <ul>
                                <li><strong>Soma Process</strong>: ABCD</li>
                                <li><strong>Soma Branching</strong>: ABCD</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="main-content">
        <section class="info-section glass">
            <h2>Mesh Construction Process</h2>
            <div class="mesh-info">
                <div class="mesh-type">
                    <h3>Axon Network Construction</h3>
                    <ul>
                        <li><strong>Axon Box</strong>: Created by arranging multiple axon.ply meshes in a box-like pattern, simulating axon bundles in white matter tracts</li>
                        <li><strong>Axon Crossing</strong>: Generated by intersecting multiple axon.ply meshes at different angles, representing crossing fiber pathways in the brain</li>
                    </ul>
                </div>
                <div class="mesh-type">
                    <h3>Soma Network Development</h3>
                    <ul>
                        <li><strong>Soma Process</strong>: Extends the base soma.ply with dendritic processes, showing basic neuronal morphology</li>
                        <li><strong>Soma Branching</strong>: Complex branching patterns created by combining multiple soma.ply meshes with varying dendritic arborizations</li>
                    </ul>
                </div>
            </div>
        </section>
    </div>
    <footer>
        <p>dMRI Toolbox â€¢ Interactive Neural Mesh Visualization</p>
    </footer>
    <script type="module" src="script.js"></script>
    <script>
    function updateAxonBranchLines() {
        const base = document.getElementById('axon-base-block');
        const box = document.getElementById('axon-box-block');
        const crossing = document.getElementById('axon-crossing-block');
        const soma = document.getElementById('soma-base-block');
        const somaProcess = document.getElementById('soma-process-block');
        const somaBranching = document.getElementById('soma-branching-block');
        const svg = document.getElementById('axon-branch-svg');
        if (!base || !box || !crossing || !soma || !somaProcess || !somaBranching || !svg) return;
        
        const parentRect = svg.parentElement.getBoundingClientRect();
        const baseRect = base.getBoundingClientRect();
        const boxRect = box.getBoundingClientRect();
        const crossingRect = crossing.getBoundingClientRect();
        const somaRect = soma.getBoundingClientRect();
        const somaProcessRect = somaProcess.getBoundingClientRect();
        const somaBranchingRect = somaBranching.getBoundingClientRect();
        
        // Calculate arrow points relative to parent
        const arrowSize = 8; // Size of the arrow head
        
        // Axon connections (sequential)
        const axonStart = {
            x: baseRect.right - parentRect.left,
            y: baseRect.top + baseRect.height/2 - parentRect.top
        };
        const axonBoxStart = {
            x: boxRect.right - parentRect.left,
            y: boxRect.top + boxRect.height/2 - parentRect.top
        };
        const axonBoxEnd = {
            x: boxRect.left - parentRect.left,
            y: boxRect.top + boxRect.height/2 - parentRect.top
        };
        const axonCrossingEnd = {
            x: crossingRect.left - parentRect.left,
            y: crossingRect.top + crossingRect.height/2 - parentRect.top
        };
        
        // Soma connections (sequential)
        const somaStart = {
            x: somaRect.right - parentRect.left,
            y: somaRect.top + somaRect.height/2 - parentRect.top
        };
        const somaProcessStart = {
            x: somaProcessRect.right - parentRect.left,
            y: somaProcessRect.top + somaProcessRect.height/2 - parentRect.top
        };
        const somaProcessEnd = {
            x: somaProcessRect.left - parentRect.left,
            y: somaProcessRect.top + somaProcessRect.height/2 - parentRect.top
        };
        const somaBranchingEnd = {
            x: somaBranchingRect.left - parentRect.left,
            y: somaBranchingRect.top + somaBranchingRect.height/2 - parentRect.top
        };
        
        // Calculate arrow angles
        const axonBoxAngle = Math.atan2(axonBoxEnd.y - axonStart.y, axonBoxEnd.x - axonStart.x);
        const axonCrossingAngle = Math.atan2(axonCrossingEnd.y - axonBoxStart.y, axonCrossingEnd.x - axonBoxStart.x);
        const somaProcessAngle = Math.atan2(somaProcessEnd.y - somaStart.y, somaProcessEnd.x - somaStart.x);
        const somaBranchingAngle = Math.atan2(somaBranchingEnd.y - somaProcessStart.y, somaBranchingEnd.x - somaProcessStart.x);
        
        // Calculate arrow head points
        const createArrowHead = (endX, endY, angle) => {
            const x1 = endX - arrowSize * Math.cos(angle - Math.PI/6);
            const y1 = endY - arrowSize * Math.sin(angle - Math.PI/6);
            const x2 = endX - arrowSize * Math.cos(angle + Math.PI/6);
            const y2 = endY - arrowSize * Math.sin(angle + Math.PI/6);
            return `M ${endX} ${endY} L ${x1} ${y1} L ${x2} ${y2} Z`;
        };
        
        svg.setAttribute('width', parentRect.width);
        svg.setAttribute('height', parentRect.height);
        svg.innerHTML = `
            <!-- Axon connections (sequential) -->
            <path d="M ${axonStart.x} ${axonStart.y} L ${axonBoxEnd.x} ${axonBoxEnd.y}" 
                  stroke="#2d2d8f" stroke-width="2.5" fill="none"/>
            <path d="${createArrowHead(axonBoxEnd.x, axonBoxEnd.y, axonBoxAngle)}" 
                  fill="#2d2d8f"/>
            <path d="M ${axonBoxStart.x} ${axonBoxStart.y} L ${axonCrossingEnd.x} ${axonCrossingEnd.y}" 
                  stroke="#2d2d8f" stroke-width="2.5" fill="none"/>
            <path d="${createArrowHead(axonCrossingEnd.x, axonCrossingEnd.y, axonCrossingAngle)}" 
                  fill="#2d2d8f"/>
            
            <!-- Soma connections (sequential) -->
            <path d="M ${somaStart.x} ${somaStart.y} L ${somaProcessEnd.x} ${somaProcessEnd.y}" 
                  stroke="#6c63ff" stroke-width="2.5" fill="none"/>
            <path d="${createArrowHead(somaProcessEnd.x, somaProcessEnd.y, somaProcessAngle)}" 
                  fill="#6c63ff"/>
            <path d="M ${somaProcessStart.x} ${somaProcessStart.y} L ${somaBranchingEnd.x} ${somaBranchingEnd.y}" 
                  stroke="#6c63ff" stroke-width="2.5" fill="none"/>
            <path d="${createArrowHead(somaBranchingEnd.x, somaBranchingEnd.y, somaBranchingAngle)}" 
                  fill="#6c63ff"/>
        `;
    }

    window.addEventListener('DOMContentLoaded', updateAxonBranchLines);
    window.addEventListener('resize', updateAxonBranchLines);
    setTimeout(updateAxonBranchLines, 500);
    </script>
</body>
</html>
