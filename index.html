<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Brain Imaging Toolbox</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- ====================== NAVBAR ====================== -->
  <nav class="main-nav glass">
    <div class="nav-content">
      <a href="index.html" class="nav-logo">Brain Imaging Toolbox</a>
    </div>
  </nav>

  <!-- ====================== HERO/VIDEO ====================== -->
  <section class="hero-section">
    <video class="hero-video" preload="auto" autoplay muted loop playsinline 
           onloadstart="this.classList.add('loading')" 
           oncanplay="this.classList.remove('loading')"
           onerror="this.style.display='none'; this.parentElement.classList.add('video-error')">
      <source src="video/background.mp4" type="video/mp4" />
    </video>
    <div class="hero-title">
      <h1>Brain Imaging Toolbox</h1>
      <p>Meshing, Simulation, and AI</p>
    </div>
  </section>

  <script>
    // Add timeout for video loading
    document.addEventListener('DOMContentLoaded', function() {
      const video = document.querySelector('.hero-video');
      const heroSection = video.parentElement;

      // Check if browser is WeChat
      const isWeChat = /MicroMessenger/i.test(navigator.userAgent);
      if (isWeChat) {
        video.style.display = 'none';
        heroSection.classList.add('video-error');
        return; // Skip timeout if WeChat browser
      }

      const timeoutId = setTimeout(() => {
        if (video.classList.contains('loading')) {
          video.style.display = 'none';
          heroSection.classList.add('video-error');
        }
      }, 1000); // 1 second timeout

      // Clear timeout if video loads successfully
      video.addEventListener('canplay', () => {
        clearTimeout(timeoutId);
      });
    });
  </script>

  <!-- ====================== TOOLBOX OVERVIEW ====================== -->
  <section class="toolbox-overview-section">
    <div class="toolbox-overview-inner glass">
      <div class="toolbox-overview-content">
        <h2>Brain Imaging Toolbox Overview</h2>

        <!-- Interactive Toolbox Diagram -->
        <div class="toolbox-diagram">
          <div class="toolbox-center">Brain Imaging Toolbox</div>
          <div class="components-container">
            <svg class="component-lines">
              <!-- Lines will be drawn here via JavaScript -->
            </svg>
            <div class="components">
              <div class="component mesh">Meshing</div>
              <div class="component dmri">dMRI Simulation</div>
              <div class="component ai">AI Coding Assistant</div>
            </div>
          </div>
        </div>

        <div class="toolbox-info">
          <h3>How the Toolbox Works</h3>
          <p>The toolbox operates through a synergistic interaction between its core components:</p>
          <ul>
            <li><strong>Meshing:</strong> Using Blender, we construct high-fidelity 3D models of neural structures with customizable parameters. These meshes serve as the foundational geometric data for simulations.</li>
            <li><strong>dMRI Simulation:</strong> The generated neural meshes are used as input for simulating realistic dMRI signals, letting researchers explore how microstructure influences diffusion patterns.</li>
            <li><strong>AI Coding Assistant:</strong> Integrated into the platform, the AI assistant supports coding tasks—from Blender scripting to simulation-data analysis.</li>
          </ul>
          <p>Together these components create an end-to-end workflow for neural-imaging research and development.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ====================== dMRI EXPLANATION ====================== -->
  <section class="dmri-section" id="dmri-section">
    <div class="dmri-inner">
      <div class="dmri-content glass">
        <h2>Understanding dMRI</h2>
        <div class="video-container">
          <iframe
            width="100%"
            height="500"
            src="https://www.youtube.com/embed/Be51OqnBbdc"
            title="Understanding dMRI"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
        </div>
        <div class="dmri-explanation">
          <div class="dmri-info">
            <h3>What is Diffusion MRI?</h3>
            <p>
              Diffusion MRI (dMRI) is a specialized magnetic resonance imaging technique that
              measures the random motion of water molecules in biological tissues. This motion is
              influenced by the tissue's microstructure, particularly the orientation and organization
              of nerve fibers in the brain.
            </p>
            <h3>Key Concepts in dMRI</h3>
            <ul>
              <li><strong>Water Diffusion</strong>: Water molecules naturally move in random directions, but their movement is restricted by tissue structures.</li>
              <li><strong>Anisotropic Diffusion</strong>: In white matter, water moves more freely along nerve fibers than across them.</li>
              <li><strong>Diffusion Tensor Imaging (DTI)</strong>: A common dMRI technique that models water diffusion as a 3D ellipsoid.</li>
              <li><strong>Fiber Tractography</strong>: The process of reconstructing neural pathways based on diffusion data.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ====================== MESH CONSTRUCTION ====================== -->
  <section class="mesh-section" id="mesh-section">
    <div class="mesh-inner">
      <div class="mesh-content glass">
        <h2>Brain Mesh Construction</h2>
        <div class="axon-mesh-branching">
          <div class="grid-container">
            <!-- First row -->
            <div class="grid-row">
              <div class="axon-block axon-base" id="axon-base-block">
                <div class="axon-label">Axon (Base)</div>
                <div class="mesh-viewer" id="axon-viewer"></div>
              </div>
              <div class="axon-block axon-box" id="axon-box-block">
                <div class="axon-label">Axon Box</div>
                <div class="mesh-viewer" id="axonbox-viewer"></div>
              </div>
              <div class="axon-block axon-crossing" id="axon-crossing-block">
                <div class="axon-label">Axon Crossing</div>
                <div class="mesh-viewer" id="axoncrossing-viewer"></div>
              </div>
            </div>
            <!-- Second row -->
            <div class="grid-row">
              <div class="axon-block soma-base" id="soma-base-block">
                <div class="axon-label">Soma (Base)</div>
                <div class="mesh-viewer" id="soma-viewer"></div>
              </div>
              <div class="axon-block soma-process" id="soma-process-block">
                <div class="axon-label">Soma Process</div>
                <div class="mesh-viewer" id="somaprocess-viewer"></div>
              </div>
              <div class="axon-block soma-branching" id="soma-branching-block">
                <div class="axon-label">Soma Branching</div>
                <div class="mesh-viewer" id="somabranching-viewer"></div>
              </div>
            </div>
          </div>
          <svg
            class="axon-branch-svg"
            id="axon-branch-svg"
            width="100%"
            height="100%"
            style="position:absolute; top:0; left:0; pointer-events:none; z-index:1;">
          </svg>
      </div>
      <div class="blender-info-wrapper">
        <div class="blender-info">
            <img
              src="images/Logo_Blender.png"
              alt="Blender Logo"
              class="blender-logo" />
            <h3>Mesh Construction with Blender</h3>
            <div class="message-content">
              <p>We use Blender's powerful 3D modeling capabilities to create neural meshes through a custom parameterized workflow. This approach allows us to:</p>
              <ul>
                <li>Generate neural structures with adjustable parameters</li>
                <li>Create realistic axon and soma networks</li>
                <li>Export optimized meshes for dMRI simulation</li>
              </ul>
              <p>Our workflow streamlines the creation of neural structures, from simple axon bundles to complex branching patterns, ensuring precise geometric properties for accurate dMRI simulation.</p>
            </div>
      </div>
      </div>          
      </div>
    </div>
  </section>

  <!-- ====================== AI CODING ASSISTANT ====================== -->
   <section class="ai-assistant-section" id="ai-section">
    <div class="chat-container">
        <div class="chat-header">
          <h1>AI Coding Assistant</h1>
        </div>
        <div class="chat-messages" id="chat-messages">
          <!-- Messages (bot and user) will be appended here -->
        </div>
        <div class="chat-input-container">
          <textarea id="chat-input" placeholder="Type your message here..." autocomplete="off"></textarea>
          <button id="send-button">
            <span>Send</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 2L11 13M22 2L15 22L11 13L2 9L22 2Z" />
            </svg>
          </button>
        </div>
        <div class="ai-model-info glass">
          <img src="images/Logo_Qwen-2.5-Coder.png" alt="Qwen 2.5 Coder Logo" class="ai-model-logo">
          <h3>Powered by Advanced AI</h3>
          <div class="message-content">
            <p>Our AI coding assistant is built on <code>Qwen2.5-Coder-32B-Instruct</code> that has been LoRA fine-tuned using <strong>Group Relative Policy Optimization (GRPO)</strong>. This advanced training methodology enables the model to:</p>
            <ul>
                <li>Learn from group-based feedback to improve response quality</li>
                <li>Maintain consistent coding style and best practices</li>
                <li>Provide more accurate and contextually relevant solutions</li>
                <li>Adapt to different programming paradigms and requirements</li>
            </ul>
            <p>The GRPO approach helps ensure that the assistant's responses are not only technically correct but also aligned with industry standards and best practices.</p>
          </div>
        </div>
      </div>
   </section>

  <!-- ====================== MAIN CONTENT ====================== -->
  <footer>
    <p>Brain Imaging Toolbox • Gradient Explode</p>
  </footer>

    <!-- 1) Load Marked.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- 2) Configure MathJax BEFORE loading the MathJax script -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [
            ['$$', '$$'],     // standard $$…$$
            ['\\[', '\\]']    // standard \[…\]
            // Note: plain "["/"]" is NOT here, so "[ ... ]" won't render by itself.
          ],
          processEscapes: true,
          processEnvironments: true
        },
        svg: { fontCache: 'global' }
      };
    </script>
    <!-- 3) Load MathJax -->
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
  
    <!-- 4) (Optional) GSAP, ScrollTrigger, etc., if you still need them for other parts of your page. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" defer></script>
    <!-- 5) Your own script that handles chat + Markdown/LaTeX rendering -->
    <script type="module" src="script.js"></script>
</body>
</html>
